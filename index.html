<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@h1deya/langchain-google-genai-ex - v0.0.1</title><meta name="description" content="Documentation for @h1deya/langchain-google-genai-ex"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"><a href="https://github.com/hideya/langchain-google-genai-ex">GitHub</a><a href="https://www.npmjs.com/package/@h1deya/langchain-google-genai-ex">NPM</a></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@h1deya/langchain-google-genai-ex - v0.0.1</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@h1deya/langchain-google-genai-ex - v0.0.1</h1></div><div class="tsd-panel tsd-typography"><a id="md:fix-gemini-400-error-with-langchainjs--mcp-license-mit-npm-version" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Fix Gemini &quot;400 Error&quot; with LangChain.js +Â MCP <a href="https://github.com/hideya/langchain-google-genai-ex/blob/main/LICENSE" target="_blank" class="external"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT"></a> <a href="https://www.npmjs.com/package/@h1deya/langchain-google-genai-ex" target="_blank" class="external"><img src="https://img.shields.io/npm/v/@h1deya/langchain-google-genai-ex.svg" alt="npm version"></a><a href="#md:fix-gemini-400-error-with-langchainjs--mcp-license-mit-npm-version" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:drop-in-replacement-that-unblocks-mcp-tool-schemas-in-gemini" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Drop-in replacement that unblocks MCP tool schemas inÂ Gemini<a href="#md:drop-in-replacement-that-unblocks-mcp-tool-schemas-in-gemini" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This library provides <strong>a drop-in replacement for <code>@langchain/google-genai</code>
that fixes Gemini's 400 Bad Request errors</strong> when using LangChain.js with MCP servers.
Automatically transforms schemas with unsupported constructs (e.g., anyOf, allOf) into Gemini-compatible JSON.</p>
<p>The schema error usually looks like:<br>
<code>[GoogleGenerativeAI Error]: ... [400 Bad Request] Invalid JSON payload received.</code></p>
<p>This error typically occurs when using <code>MultiServerMCPClient()</code>.<br>
This library prevents its cascading failures where one complex server breaks the entire MCP integration.</p>
<a id="md:how-to-use-this-library" class="tsd-anchor"></a><h2 class="tsd-anchor-link">How to Use This Library<a href="#md:how-to-use-this-library" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:drop-in-replacement" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Drop-in Replacement<a href="#md:drop-in-replacement" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Replace:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">ChatGoogleGenerativeAI</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@langchain/google-genai&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">...</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">llm</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">ChatGoogleGenerativeAI</span><span class="hl-1">({ ... });</span>
</code><button type="button">Copy</button></pre>

<p>with:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">ChatGoogleGenerativeAIEx</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@h1deya/langchain-google-genai-ex&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">...</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">llm</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">ChatGoogleGenerativeAIEx</span><span class="hl-1">({ ... });</span>
</code><button type="button">Copy</button></pre>

<p><strong>That's it!</strong> No configuration, no additional steps.</p>
<p><strong>This automatically fixes:</strong></p>
<ul>
<li>âœ… &quot;anyOf must be the only field set&quot; errors</li>
<li>âœ… &quot;Unknown name 'exclusiveMaximum'&quot; schema validation errors</li>
<li>âœ… &quot;Invalid JSON payload&quot; errors from complex MCP schemas</li>
<li>âœ… Cascading failures where one complex server breaks entire MCP integration</li>
<li>âœ… Works with both Gemini 1.5 and 2.5</li>
</ul>
<p>You can easily switch back to the original <code>ChatGoogleGenerativeAI</code>
when its schema handling improves,
or when the MCP server's schema improves to meet Gemini's strict requirements.</p>
<p>A simple usage example, which is ready to clone and run, can be found
<a href="https://github.com/hideya/langchain-google-genai-ex-usage" target="_blank" class="external">here</a>.</p>
<blockquote>
<p>This library addresses compatibility issues present as of September 5, 2025, with LangChain.js (@langchain/core) v0.3.72 and @langchain/google-genai v0.2.16.</p>
</blockquote>
<a id="md:table-of-contents" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Table of Contents<a href="#md:table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Below we'll explain what and how this library works in detail:</p>
<ul>
<li><a href="#md:prerequisites">Prerequisites</a></li>
<li><a href="#md:installation">Installation</a></li>
<li><a href="#md:the-problem-youre-probably-having">The Problem You're Probably Having</a></li>
<li><a href="#md:complete-usage-example">Complete Usage Example</a></li>
<li><a href="#md:debugging-verbose-logging">Debugging: Verbose Logging</a></li>
<li><a href="#md:features">Features</a></li>
<li><a href="https://hideya.github.io//langchain-google-genai-ex/classes/ChatGoogleGenerativeAIEx.html" target="_blank" class="external">API Reference</a></li>
</ul>
<a id="md:prerequisites" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Prerequisites<a href="#md:prerequisites" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Before installing, make sure you have:</p>
<ul>
<li><strong>Node.js 18+</strong> - Required for modern JavaScript features</li>
<li><strong>Google API Key</strong> - Get yours at <a href="https://ai.google.dev/gemini-api/docs/api-key" target="_blank" class="external">Google AI Studio</a></li>
<li><strong>LangChain.js</strong> - This package works with <a href="https://www.npmjs.com/package/@langchain/core" target="_blank" class="external"><code>@langchain/core</code></a>
and <a href="https://www.npmjs.com/package/@langchain/mcp-adapters" target="_blank" class="external"><code>@langchain/mcp-adapters</code></a></li>
<li><strong>MCP Servers</strong> - Access to the MCP servers you want to use</li>
</ul>
<p>Tested with <code>@langchain/core@0.3.72</code> and <code>@langchain/google-genai@0.2.16</code>.</p>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-6">npm</span><span class="hl-1"> </span><span class="hl-3">i</span><span class="hl-1"> </span><span class="hl-3">@h1deya/langchain-google-genai-ex</span>
</code><button type="button">Copy</button></pre>

<a id="md:the-problem-youre-probably-having" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Problem You're Probably Having<a href="#md:the-problem-youre-probably-having" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If you've ever tried using <strong>Google Gemini</strong> together with <strong>LangChain.js</strong> and <strong>MCP servers with complex schemas</strong>, you may have run into this error:</p>
<pre><code><span class="hl-1">[</span><span class="hl-2">GoogleGenerativeAI</span><span class="hl-1"> </span><span class="hl-2">Error</span><span class="hl-1">]: </span><span class="hl-2">Error</span><span class="hl-1"> </span><span class="hl-2">fetching</span><span class="hl-1"> </span><span class="hl-2">from</span><span class="hl-1"> </span><br/><span class="hl-7">https</span><span class="hl-1">:</span><span class="hl-8">//generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent: </span><br/><span class="hl-1">[</span><span class="hl-9">400</span><span class="hl-1"> </span><span class="hl-2">Bad</span><span class="hl-1"> </span><span class="hl-2">Request</span><span class="hl-1">] </span><span class="hl-2">Invalid</span><span class="hl-1"> </span><span class="hl-5">JSON</span><span class="hl-1"> </span><span class="hl-2">payload</span><span class="hl-1"> </span><span class="hl-2">received</span><span class="hl-1">. </span><br/><span class="hl-2">Unknown</span><span class="hl-1"> </span><span class="hl-2">name</span><span class="hl-1"> </span><span class="hl-3">&quot;anyOf&quot;</span><span class="hl-1"> </span><span class="hl-2">at</span><span class="hl-1"> </span><span class="hl-3">&#39;tools[0].function_declarations[8]..</span><span class="hl-10">.</span>
</code><button>Copy</button></pre>

<p>This typically occurs when you configure multiple MCP servers using <code>MultiServerMCPClient</code>,
especially when some of the servers have complex schemas.</p>
<p>If you searched for <code>GoogleGenerativeAIFetchError: [GoogleGenerativeAI Error] 400 Bad Request</code>,
the following sections explain the cause and how to workaround it when using LangChain.</p>
<blockquote>
<p>The MCP servers I have encountered so far that have failed are:</p>
<ul>
<li><code>@notionhq/notion-mcp-server@1.9.0</code> (run with <code>npx</code>)</li>
<li><code>airtable-mcp-server@1.6.1</code> (run with <code>npx</code>)</li>
<li><code>mcp-server-fetch==2025.4.7</code> (run with <code>uvx</code>)</li>
</ul>
</blockquote>
<a id="md:why-this-happens" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Why ThisÂ Happens<a href="#md:why-this-happens" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><a href="https://ai.google.dev/api/caching#Schema" target="_blank" class="external"><strong>Gemini's schema requirements for function calling are very strict</strong></a>.</li>
<li>MCP servers define their tools using flexible JSON schemas, and LLMs invoke MCP tools via function calling.
Most LLMs accept these schemas just fine.</li>
<li>However, Gemini API rejects MCP tool schemas if they contain fields it doesn't expect (e.g., use of <code>anyOf</code>).</li>
<li>The result is a <strong>400 Bad Request</strong>â€Š-â€Ševen though the same MCP server works fine with OpenAI, Anthropic, etc.</li>
<li>Google Vertex AI that supports API endpoints with relaxed schema requirements but it requires GCP setup.</li>
<li>Google provides a fix in its new Gemini SDK (<a href="https://github.com/googleapis/js-genai?tab=readme-ov-file#model-context-protocol-mcp-support-experimental" target="_blank" class="external"><code>@google/genai</code></a>),
but LangChain.js users cannot leverage it due to architectural incompatibility.</li>
</ul>
<p>For many developers, this can make Gemini difficult to use with LangChain.js and some MCP servers.
Even if only one incompatible MCP server is included in the MCP definitions passed to <code>MultiServerMCPClient</code>,
all subsequent MCP usage starts failing with the 400 Bad Request error.</p>
<p><strong>This library handles all these schema incompatibilities through schema transformation,
converting complex MCP tool schemas into Gemini-friendly formats</strong>,
so you can focus on building instead of debugging schema errors.</p>
<a id="md:complete-usage-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Complete Usage Example<a href="#md:complete-usage-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-8">// import { ChatGoogleGenerativeAI } from &quot;@langchain/google-genai&quot;;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">ChatGoogleGenerativeAIEx</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@h1deya/langchain-google-genai-ex&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createReactAgent</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@langchain/langgraph/prebuilt&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">MultiServerMCPClient</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@langchain/mcp-adapters&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">HumanMessage</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@langchain/core/messages&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// The following Fetch MCP server causes &quot;400 Bad Request&quot;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">MultiServerMCPClient</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">mcpServers:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">fetch:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">command:</span><span class="hl-1"> </span><span class="hl-3">&quot;uvx&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">args:</span><span class="hl-1"> [</span><span class="hl-3">&quot;mcp-server-fetch==2025.4.7&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">mcpTools</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-6">getTools</span><span class="hl-1">();</span><br/><br/><span class="hl-8">// const llm = new ChatGoogleGenerativeAI({ model: &quot;gemini-2.5-flash&quot; });</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">llm</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">ChatGoogleGenerativeAIEx</span><span class="hl-1">({ </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-3">&quot;gemini-2.5-flash&quot;</span><span class="hl-1">} );</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">agent</span><span class="hl-1"> = </span><span class="hl-6">createReactAgent</span><span class="hl-1">({ </span><span class="hl-2">llm</span><span class="hl-1">, </span><span class="hl-2">tools:</span><span class="hl-1"> </span><span class="hl-2">mcpTools</span><span class="hl-1"> });</span><br/><br/><span class="hl-8">// This works! No more schema errors</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">agent</span><span class="hl-1">.</span><span class="hl-6">invoke</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">HumanMessage</span><span class="hl-1">(</span><span class="hl-3">&quot;Read the top news headlines on bbc.com&quot;</span><span class="hl-1">)]</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">messages</span><span class="hl-1">[</span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-2">messages</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> - </span><span class="hl-9">1</span><span class="hl-1">].</span><span class="hl-2">content</span><span class="hl-1">);</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>A simple usage example, which is ready to clone and run, can be found
<a href="https://github.com/hideya/langchain-google-genai-ex-usage" target="_blank" class="external">here</a>.</p>
<p><strong>Key Benefits:</strong></p>
<ul>
<li><strong>Simple to use</strong> - Just replace the import and the classname</li>
<li><strong>Preserves all functionality</strong> - Streaming, system instructions, etc.</li>
<li><strong>No breaking changes</strong> - Drop-in replacement for ChatGoogleGenerativeAI</li>
</ul>
<a id="md:debugging-verbose-logging" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Debugging: Verbose Logging<a href="#md:debugging-verbose-logging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Want to see exactly what schema transformations are happening? Set the environment variable to get detailed logs:</p>
<pre><code class="bash"><span class="hl-2">LANGCHAIN_GOOGLE_GENAI_EX_VERBOSE</span><span class="hl-1">=</span><span class="hl-3">true</span>
</code><button type="button">Copy</button></pre>

<p><strong>Example output:</strong></p>
<pre><code><span class="hl-1">ðŸ”§ </span><span class="hl-2">Transforming</span><span class="hl-1"> </span><span class="hl-9">3</span><span class="hl-1"> </span><span class="hl-5">MCP</span><span class="hl-1"> </span><span class="hl-6">tool</span><span class="hl-1">(</span><span class="hl-2">s</span><span class="hl-1">) </span><span class="hl-2">for</span><span class="hl-1"> </span><span class="hl-2">Gemini</span><span class="hl-1"> </span><span class="hl-2">compatibility</span><span class="hl-1">...</span><br/><span class="hl-1">  âœ… </span><span class="hl-2">get</span><span class="hl-1">-</span><span class="hl-7">alerts</span><span class="hl-1">: </span><span class="hl-2">No</span><span class="hl-1"> </span><span class="hl-2">transformation</span><span class="hl-1"> </span><span class="hl-6">needed</span><span class="hl-1"> (</span><span class="hl-2">simple</span><span class="hl-1"> </span><span class="hl-2">schema</span><span class="hl-1">)</span><br/><span class="hl-1">  âœ… </span><span class="hl-2">get</span><span class="hl-1">-</span><span class="hl-7">forecast</span><span class="hl-1">: </span><span class="hl-2">No</span><span class="hl-1"> </span><span class="hl-2">transformation</span><span class="hl-1"> </span><span class="hl-6">needed</span><span class="hl-1"> (</span><span class="hl-2">simple</span><span class="hl-1"> </span><span class="hl-2">schema</span><span class="hl-1">)</span><br/><span class="hl-1">  ðŸ”„ </span><span class="hl-7">fetch</span><span class="hl-1">: </span><span class="hl-9">2</span><span class="hl-1"> </span><span class="hl-2">exclusive</span><span class="hl-1"> </span><span class="hl-6">bound</span><span class="hl-1">(</span><span class="hl-2">s</span><span class="hl-1">) </span><span class="hl-2">converted</span><span class="hl-1">, </span><span class="hl-9">1</span><span class="hl-1"> </span><span class="hl-2">unsupported</span><span class="hl-1"> </span><span class="hl-6">format</span><span class="hl-1">(</span><span class="hl-2">s</span><span class="hl-1">) </span><span class="hl-6">removed</span><span class="hl-1"> (</span><span class="hl-2">uri</span><span class="hl-1">)</span><br/><span class="hl-1">ðŸ“Š </span><span class="hl-7">Summary</span><span class="hl-1">: </span><span class="hl-9">1</span><span class="hl-1">/</span><span class="hl-9">3</span><span class="hl-1"> </span><span class="hl-6">tool</span><span class="hl-1">(</span><span class="hl-2">s</span><span class="hl-1">) </span><span class="hl-2">required</span><span class="hl-1"> </span><span class="hl-2">schema</span><span class="hl-1"> </span><span class="hl-2">transformation</span>
</code><button>Copy</button></pre>

<p><strong>When to use verbose logging:</strong></p>
<ul>
<li><strong>Debugging</strong>: When tools aren't working as expected</li>
<li><strong>Understanding</strong>: See what complex schemas are being simplified</li>
<li><strong>Verification</strong>: Confirm that transformations are happening correctly</li>
<li><strong>Development</strong>: Monitor which MCP servers need schema fixes</li>
</ul>
<p>The verbose output helps you understand:</p>
<ul>
<li>Which tools have complex schemas that need transformation</li>
<li>What specific changes are being made (anyOf fixes, type conversions, etc.)</li>
<li>How many tools in your setup require compatibility fixes</li>
</ul>
<a id="md:features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Features<a href="#md:features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:all-original-chatgooglegenerativeai-features" class="tsd-anchor"></a><h3 class="tsd-anchor-link">All Original ChatGoogleGenerativeAI Features<a href="#md:all-original-chatgooglegenerativeai-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><code>ChatGoogleGenerativeAIEx</code> extends the original class, so you get everything:</p>
<ul>
<li>Streaming, function calling, system instructions</li>
<li>All model parameters and configurations</li>
<li>Full LangChain.js integration</li>
</ul>
<a id="md:comprehensive-schema-transformation" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Comprehensive Schema Transformation<a href="#md:comprehensive-schema-transformation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Systematic conversion</strong> of <code>allOf</code>/<code>anyOf</code>/<code>oneOf</code> to equivalent object structures</li>
<li><strong>Reference resolution</strong> - handles <code>$ref</code> and <code>$defs</code> by flattening definitions</li>
<li><strong>Type normalization</strong> - converts type arrays <code>[&quot;string&quot;, &quot;null&quot;]</code> to <code>nullable</code> properties</li>
<li><strong>Property validation</strong> - filters <code>required</code> fields that don't exist in <code>properties</code></li>
<li><strong>Format compatibility</strong> - removes unsupported JSON Schema formats and keywords</li>
<li><strong>Nested structure handling</strong> - recursively processes complex object hierarchies</li>
</ul>
<a id="md:known-limitations" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Known Limitations<a href="#md:known-limitations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Unresolved references:</strong> If a schema points to <code>$ref</code> definitions that aren't available, they're simplified to a generic object.</li>
<li><strong>Tuple-style arrays:</strong> For schemas that define arrays with position-specific types, only the first item is used.</li>
<li><strong>Enums and formats:</strong> Only string enums and a small set of formats are kept; others are dropped.</li>
<li><strong>Complex combinations:</strong> <code>oneOf</code>/<code>allOf</code> are simplified, which may loosen or slightly change validation rules.</li>
</ul>
<p>These adjustments keep most MCP tools working, but rare edge cases could behave differently from the original schema.
Please report issues you encounter using <a href="https://github.com/hideya/langchain-google-genai-ex/issues" target="_blank" class="external">Issue</a>.</p>
<p>See <a href="media/DESIGN_DECISIONS.md">this design decision document</a> for the implementation details.</p>
<a id="md:api-reference" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API Reference<a href="#md:api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Can be found <a href="https://hideya.github.io//langchain-google-genai-ex/classes/ChatGoogleGenerativeAIEx.html" target="_blank" class="external">here</a></p>
<a id="md:links" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Links<a href="#md:links" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://github.com/hideya/langchain-google-genai-ex-usage" target="_blank" class="external">A simple usage example</a> which is ready to clone and run</li>
<li><a href="media/DESIGN_DECISIONS.md">Design decision document</a> describes the implementation details</li>
</ul>
<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="media/LICENSE">MIT</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:fix-gemini-400-error-with-langchainjs--mcp-license-mit-npm-version"><span>Fix <wbr/>Gemini &quot;400 <wbr/>Error&quot; with <wbr/>Lang<wbr/>Chain.js +Â MCP <wbr/>License: MIT npm version</span></a><ul><li><ul><li><a href="#md:drop-in-replacement-that-unblocks-mcp-tool-schemas-in-gemini"><span>Drop-<wbr/>in replacement that unblocks MCP tool schemas inÂ <wbr/>Gemini</span></a></li></ul></li><li><a href="#md:how-to-use-this-library"><span>How to <wbr/>Use <wbr/>This <wbr/>Library</span></a></li><li><ul><li><a href="#md:drop-in-replacement"><span>Drop-<wbr/>in <wbr/>Replacement</span></a></li></ul></li><li><a href="#md:table-of-contents"><span>Table of <wbr/>Contents</span></a></li><li><a href="#md:prerequisites"><span>Prerequisites</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:the-problem-youre-probably-having"><span>The <wbr/>Problem <wbr/>You&#39;re <wbr/>Probably <wbr/>Having</span></a></li><li><ul><li><a href="#md:why-this-happens"><span>Why <wbr/>ThisÂ <wbr/>Happens</span></a></li></ul></li><li><a href="#md:complete-usage-example"><span>Complete <wbr/>Usage <wbr/>Example</span></a></li><li><a href="#md:debugging-verbose-logging"><span>Debugging: <wbr/>Verbose <wbr/>Logging</span></a></li><li><a href="#md:features"><span>Features</span></a></li><li><ul><li><a href="#md:all-original-chatgooglegenerativeai-features"><span>All <wbr/>Original <wbr/>Chat<wbr/>Google<wbr/>GenerativeAI <wbr/>Features</span></a></li><li><a href="#md:comprehensive-schema-transformation"><span>Comprehensive <wbr/>Schema <wbr/>Transformation</span></a></li><li><a href="#md:known-limitations"><span>Known <wbr/>Limitations</span></a></li></ul></li><li><a href="#md:api-reference"><span>API <wbr/>Reference</span></a></li><li><a href="#md:links"><span>Links</span></a></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/hideya/langchain-google-genai-ex" class="tsd-nav-link">GitHub</a><a href="https://www.npmjs.com/package/@h1deya/langchain-google-genai-ex" class="tsd-nav-link">NPM</a></nav><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@h1deya/langchain-google-genai-ex - v0.0.1</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
